<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Descarga BluetoothChat</title>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; background:#0f172a; color:#e6eef8; }
    .card { background:#0b1220; padding:28px; border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.7); text-align:center; width:320px; }
    h1 { margin:0 0 12px; font-size:20px; }
    p { margin:0 0 18px; color:#a8bfd6; font-size:14px; }
    button { appearance:none; border:0; padding:12px 16px; border-radius:8px; font-weight:600; cursor:pointer; background:linear-gradient(180deg,#0ea5a6,#04839a); color:white; }
    small { display:block; margin-top:12px; color:#7f99b6; font-size:12px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>BluetoothChat.apk</h1>
    <p>Pulsa el botón para descargar</p>
    <img src = "eD.png"/>

    <a id="linkDownload" href="BluetoothChat.apk" download style="text-decoration:none; display:block;">
      <button id="btnDownload">Descargar APK</button>
    </a>

    <small id="status">Si el navegador abre el archivo en vez de descargarlo, espera — el botón hará fallback.</small>
  </div>

  <script>

    (function() {
      const btn = document.getElementById('btnDownload');
      const link = document.getElementById('linkDownload');
      const status = document.getElementById('status');
      const FILE_URL = 'BluetoothChat.apk'; // Debe estar en la misma carpeta que index.html
      const MAX_SAFE_SIZE_MB = 80; // advertencia si es grande

      async function tryDownloadViaFetch() {
        try {
          status.textContent = 'Preparando descarga...';
          const headResp = await fetch(FILE_URL, { method: 'HEAD' }).catch(()=>null);
          if (headResp && headResp.headers) {
            const size = headResp.headers.get('content-length');
            if (size) {
              const sizeMB = (Number(size) / (1024*1024)).toFixed(1);
              if (sizeMB > MAX_SAFE_SIZE_MB) {
                status.textContent = `Archivo ~${sizeMB} MB — intenta con el enlace directo si falla.`;
                return;
              }
            }
          }

          const resp = await fetch(FILE_URL);
          if (!resp.ok) throw new Error('Error al obtener el archivo: ' + resp.status);
          const blob = await resp.blob();
          const a = document.createElement('a');
          const url = URL.createObjectURL(blob);
          a.href = url;
          a.download = 'BluetoothChat.apk';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          status.textContent = 'Descarga iniciada.';
        } catch (err) {
          console.error(err);
          status.textContent = 'No se pudo usar el fallback. Intenta con el enlace directo.';
        }
      }
      btn.addEventListener('click', (e) => {
        if (e.shiftKey) {
          e.preventDefault();
          tryDownloadViaFetch();
        } else {
          status.textContent = 'Si no descarga, vuelve a pulsar manteniendo SHIFT.';
        }
      });
    })();
  </script>
</body>
</html>
